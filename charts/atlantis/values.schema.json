{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Atlantis Helm Chart Values Schema",
  "description": "Schema for k8sforge/atlantis-chart values.yaml configuration",
  "additionalProperties": true,
  "properties": {
    "replicaCount": {
      "type": "integer",
      "description": "Number of replicas for wrapper features (Rollouts, etc.)",
      "default": 1,
      "minimum": 0
    },
    "deployment": {
      "type": "object",
      "description": "Enhanced deployment configuration with Argo Rollouts support",
      "additionalProperties": true,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "deployment",
            "rollout"
          ],
          "default": "deployment",
          "description": "Deployment type: 'deployment' for standard K8s, 'rollout' for Argo Rollouts"
        },
        "strategy": {
          "type": "string",
          "enum": [
            "rollingUpdate",
            "blueGreen",
            "canary"
          ],
          "default": "blueGreen",
          "description": "Rollout strategy (only used if type == rollout)"
        },
        "autoPromotionEnabled": {
          "type": "boolean",
          "default": false,
          "description": "Auto-promote on deployment"
        },
        "scaleDownDelaySeconds": {
          "type": "integer",
          "default": 30,
          "minimum": 0
        }
      }
    },
    "monitoring": {
      "type": "object",
      "description": "Enhanced monitoring and observability",
      "additionalProperties": true,
      "properties": {
        "serviceMonitor": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "interval": {
              "type": "string",
              "default": "30s"
            },
            "scrapeTimeout": {
              "type": "string",
              "default": "10s"
            },
            "labels": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    },
    "podDisruptionBudget": {
      "type": "object",
      "description": "High availability configuration",
      "additionalProperties": true,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "minAvailable": {
          "type": "integer",
          "default": 1
        }
      }
    },
    "persistence": {
      "type": "object",
      "description": "Enhanced persistent storage with auto-selection",
      "additionalProperties": true,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "ebs": {
          "type": "object",
          "properties": {
            "storageClass": {
              "type": "string",
              "default": "gp3"
            },
            "size": {
              "type": "string",
              "default": "10Gi"
            }
          }
        },
        "efs": {
          "type": "object",
          "properties": {
            "storageClass": {
              "type": "string",
              "default": "efs-sc"
            },
            "size": {
              "type": "string",
              "default": "50Gi"
            }
          }
        },
        "storageClass": {
          "type": "string"
        },
        "size": {
          "type": "string"
        },
        "accessModes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "existingClaim": {
          "type": "string"
        }
      }
    },
    "atlantis": {
      "type": "object",
      "description": "Direct pass-through configuration for the official Atlantis chart",
      "additionalProperties": true,
      "properties": {
        "orgAllowlist": {
          "type": "string",
          "default": "github.com/myorg/*",
          "description": "Repository allowlist pattern"
        },
        "atlantisUrl": {
          "type": "string",
          "description": "Atlantis URL (if not using ingress)"
        },
        "logLevel": {
          "type": "string",
          "enum": [
            "debug",
            "info",
            "warn",
            "error"
          ],
          "default": "info",
          "description": "Log level"
        },
        "github": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "user": {
              "type": "string",
              "description": "GitHub username"
            },
            "token": {
              "type": "string",
              "description": "GitHub token"
            },
            "secret": {
              "type": "string",
              "description": "GitHub webhook secret"
            }
          }
        },
        "githubApp": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "id": {
              "type": [
                "string",
                "integer"
              ],
              "description": "GitHub App ID"
            },
            "slug": {
              "type": "string",
              "description": "GitHub App slug"
            },
            "key": {
              "type": "string",
              "description": "GitHub App private key"
            },
            "installationId": {
              "type": [
                "string",
                "integer"
              ],
              "description": "GitHub App installation ID"
            }
          }
        },
        "image": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "repository": {
              "type": "string",
              "default": "runatlantis/atlantis",
              "description": "Docker image repository"
            },
            "tag": {
              "type": "string",
              "default": "latest",
              "description": "Docker image tag"
            },
            "pullPolicy": {
              "type": "string",
              "enum": [
                "Always",
                "Never",
                "IfNotPresent"
              ],
              "default": "IfNotPresent",
              "description": "Image pull policy"
            }
          }
        },
        "imagePullSecrets": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "replicaCount": {
          "type": "integer",
          "default": 1,
          "minimum": 0,
          "description": "Number of replicas (automatically set to 0 when deployment.type='rollout')"
        },
        "service": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "ClusterIP",
                "LoadBalancer",
                "NodePort"
              ],
              "default": "ClusterIP"
            },
            "port": {
              "type": "integer",
              "default": 4141
            },
            "targetPort": {
              "type": "integer",
              "default": 4141
            }
          }
        },
        "ingress": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "ingressClassName": {
              "type": "string"
            },
            "annotations": {
              "type": "object",
              "additionalProperties": true
            },
            "path": {
              "type": "string",
              "default": "/"
            },
            "pathType": {
              "type": "string",
              "default": "Prefix"
            },
            "host": {
              "type": "string",
              "default": "atlantis.example.com"
            }
          }
        },
        "resources": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "limits": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "requests": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          }
        },
        "nodeSelector": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "tolerations": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "affinity": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "podAnnotations": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "podLabels": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "securityContext": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "podSecurityContext": {
          "type": "object",
          "additionalProperties": true,
          "default": {}
        },
        "serviceAccount": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "create": {
              "type": "boolean",
              "default": true
            },
            "annotations": {
              "type": "object",
              "additionalProperties": true
            },
            "name": {
              "type": "string"
            }
          }
        },
        "environmentSecrets": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "environment": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "default": {}
        },
        "command": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "dataStorage": {
          "type": "string",
          "description": "Data storage size (simple string format for official chart compatibility)",
          "default": ""
        },
        "livenessProbe": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "periodSeconds": {
              "type": "integer",
              "default": 60
            },
            "initialDelaySeconds": {
              "type": "integer",
              "default": 5
            },
            "timeoutSeconds": {
              "type": "integer",
              "default": 5
            },
            "successThreshold": {
              "type": "integer",
              "default": 1
            },
            "failureThreshold": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "readinessProbe": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "periodSeconds": {
              "type": "integer",
              "default": 60
            },
            "initialDelaySeconds": {
              "type": "integer",
              "default": 5
            },
            "timeoutSeconds": {
              "type": "integer",
              "default": 5
            },
            "successThreshold": {
              "type": "integer",
              "default": 1
            },
            "failureThreshold": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "extraVolumes": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "extraVolumeMounts": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "initContainers": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        },
        "extraContainers": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "default": []
        }
      }
    }
  }
}
