# Enhanced Atlantis Helm Chart - Wrapper Configuration
# This chart wraps the official Atlantis chart (https://github.com/runatlantis/helm-charts)
# with optional enterprise enhancements for advanced deployment strategies and operational features.
#
# ARCHITECTURE:
# - Official Atlantis chart values go under "atlantis:" key (Helm sub-chart pattern)
# - Enhancement features use "enhanced*" namespace prefixes (disabled by default)
# - Dependencies defined in Chart.yaml ensure official chart is installed
#
# For complete list of official chart values, see:
# https://github.com/runatlantis/helm-charts/blob/main/charts/atlantis/values.yaml

#############################################
# ENHANCEMENT FEATURES (disabled by default)
#############################################

# Enhanced Storage with Smart EBS/EFS Selection
# When enabled, provides intelligent storage selection based on replica count
enhancedStorage:
  enabled: false # Set to true to use enhanced PVC with EBS/EFS auto-selection

  # EBS configuration (automatically selected when atlantis.replicaCount == 1)
  ebs:
    storageClass: "gp3"
    size: 10Gi

  # EFS configuration (automatically selected when atlantis.replicaCount > 1)
  efs:
    storageClass: "efs-sc"
    size: 50Gi

  # Manual overrides (optional - disables auto-selection)
  storageClass: "" # Override: specify exact storage class
  size: "" # Override: specify exact size
  accessModes: [] # Override: specify exact access modes
  existingClaim: "" # Use existing PVC instead of creating new one

# Enhanced Monitoring with Prometheus ServiceMonitor
# When enabled, creates ServiceMonitor resource for Prometheus metrics scraping
enhancedMonitoring:
  serviceMonitor:
    enabled: false # Set to true to create ServiceMonitor for Prometheus
    interval: "30s"
    scrapeTimeout: "10s"
    labels: {}
    # labels:
    #   prometheus: kube-prometheus

# Enhanced High Availability with PodDisruptionBudget
# When enabled, ensures minimum availability during voluntary disruptions
enhancedHA:
  podDisruptionBudget:
    enabled: false # Set to true to create PodDisruptionBudget
    minAvailable: 1 # Minimum pods that must remain available
    # maxUnavailable: 1  # Alternative: maximum pods that can be unavailable

################################################################
# OFFICIAL ATLANTIS CHART VALUES (Sub-Chart Configuration)
################################################################
# All values under "atlantis:" are passed directly to the official Atlantis chart dependency.
#
# This wrapper provides a BARE MINIMUM configuration with just GitHub credentials.
# The official chart provides sensible defaults for everything else.
#
# For complete configuration options (orgAllowlist, ingress, resources, etc.), see:
# https://github.com/runatlantis/helm-charts/blob/main/charts/atlantis/values.yaml

atlantis:
  # Log level for Atlantis (required by schema validation)
  logLevel: "info"

  # Number of Atlantis replicas
  replicaCount: 1

  # GitHub authentication (Personal Access Token)
  # IMPORTANT: Replace these placeholder values with your actual credentials
  # github:
  #   user: "test-user"
  #   token: "ghp_test_token_placeholder_12345678901234567890"
  #   secret: "test-webhook-secret-12345"

  # githubApp:
  #   id: "123456"
  #   slug: "your-app-slug"
  #   key: |
  #     -----BEGIN RSA PRIVATE KEY-----
  #     ... (your private key here)
  #     -----END RSA PRIVATE KEY-----
  #   secret: "your-webhook-secret"
  #   installationId: "12345678"  # Optional: if app has multiple installations

  # Add any other official chart values here as needed:
  # orgAllowlist: "github.com/myorg/*"
  # atlantisUrl: "https://atlantis.example.com"
  # image:
  #   tag: "v0.27.0"
  # ingress:
  #   enabled: true
  #   host: "atlantis.example.com"
  # resources:
  #   limits:
  #     memory: "2Gi"
  # etc...
